language: go

go:
    # - 1.7
    - 1.8
    # - tip

os:
    - linux
    - osx

notifications:
    email:
        on_success: never
        on_failure: always

branches:
    only:
        - master

env:
    - OPENWAR_VERSION=0.0.1

install:
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install dylibbundler; fi
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y rpl; fi

    - export SDL_PREFIX=/usr/local && ./tools/sdl_from_source.sh

    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then go get golang.org/x/mobile/cmd/gomobile && go get github.com/gopherjs/gopherjs; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then gomobile init; fi

    - go get -v

script:
    - go build

    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./tools/package/build_app.sh; fi
    #- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./tools/dropbox/dropbox_uploader.sh upload OpenWar.zip Public; fi

    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/package/build_deb.sh; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/dropbox/dropbox_uploader.sh upload openwar_$OPENWAR_VERSION-$TRAVIS_BUILD_NUMBER.deb Public/openwar_$OPENWAR_VERSION.deb; fi

    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cp ./tools/package/AndroidManifest.xml ./ && gomobile build -target=android -tags=mobile; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/dropbox/dropbox_uploader.sh upload openwar.apk Public; fi

    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then $GOPATH/bin/gopherjs build openwar.go; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/dropbox/dropbox_uploader.sh upload openwar.js Public && ./tools/dropbox/dropbox_uploader.sh upload openwar.js.map Public; fi

deploy:
      provider: releases
      api_key:
          secure: Z3YiITEQs6Yncy6hl6CO62JRivun1tAQF0K7EwQm+QMxrDxY1uEfoZBKcnOH/pw7SDpqdnRTUzV4vR41ek6Fy73Q5Kq5A7f1LWEQjc6YjKoDuE4lYNV4WiGJcjCmTjHPfA5zquutjq7mmg+i1Ljp2jxtf51cSlaQYdtyLP2oUU9zQsyaS51GANtINZYzSnK5KfT5z6QXzRJXSYf6WGGrd2i5Z5GRalh0lEnfGHBCaLASpmr1Zc7q7kkMl5f2B+bSWUGFO0Tc7NGlr2TsXC6BLh1NYD1sxyiScmqFO1l6fAEWoXd/ybUafmVmwUolFXV7yqflTRckkfyYuMNma3biXhNt694oYPm9/zvq3scNNv6krXTbMmW73Qn3xLZh2eVZ+neRhHn8GGqlQrglokS7GGVTvM1VY7T0MBZfixNL+TxTT/B0Mdgu6zwkglQDL6L+5CBDl4Z5+TT/PcYJBwcWI+OtzBcRcnldxXeVqnSghfAH0LRbiJMRZzdG1CF9pRyDsKrgYQdoOfDp9Zr1U3YUh1DE1jwF6b3tippecSSUCbA/vmCzstFhqrlcpjqufxWTOV3MSDkVy2+KACTJmehVoYzdtK3ELWwrDIN9xyU9IS0L9HT2GzhKiskbdx73S9NBJOlMXg55edzjdPr8P+DjfR5c5SEdeTrSjqbM8LzZnKU=
      file:
          - openwar_$OPENWAR_VERSION.deb
          - OpenWar.zip
      skip_cleanup: true
      on:
          tags: true
