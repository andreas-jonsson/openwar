language: go

go:
    - 1.8
    # - tip

os:
    - linux
    - osx

notifications:
    email:
        on_success: never
        on_failure: always

branches:
    only:
        - master

env:
    - OPENWAR_VERSION=0.0.1

install:
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install dylibbundler; fi
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y rpl; fi

    - export SDL_PREFIX=/usr/local && ./tools/sdl_from_source.sh

    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then go get golang.org/x/mobile/cmd/gomobile && go get github.com/gopherjs/gopherjs; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then gomobile init; fi

    - go get -v

script:
    - go build

    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./tools/package/build_app.sh; fi
    #- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./tools/dropbox/dropbox_uploader.sh upload OpenWar.zip Public; fi

    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/package/build_deb.sh; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/dropbox/dropbox_uploader.sh upload openwar_$OPENWAR_VERSION-$TRAVIS_BUILD_NUMBER.deb Public/openwar_$OPENWAR_VERSION.deb; fi

    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cp ./tools/package/AndroidManifest.xml ./ && gomobile build -target=android -tags=mobile; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/dropbox/dropbox_uploader.sh upload openwar.apk Public; fi

    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then $GOPATH/bin/gopherjs build openwar.go; fi
    #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/dropbox/dropbox_uploader.sh upload openwar.js Public && ./tools/dropbox/dropbox_uploader.sh upload openwar.js.map Public; fi

deploy:
    provider: releases
    file:
        #- openwar_$OPENWAR_VERSION.deb
        #- OpenWar.zip
        - README.md
    skip_cleanup: true
    overwrite: true
    on:
        tags: false
        repo: andreas-jonsson/openwar
    api-key:
        secure: "LQO4pK+Cq31JIBV9U9qGkPjxTDnj+vc7xgOxQ/LhI7QCbGLAaW2+GjI/1cf60JukIeVIwjWnPjpLE/Foeoy4krpuKjRUsouoBOEDit36bITsxQvpExLYBnOAcFGiZOojmHOGT3L7+KNlEdkdv7ZpN0zSrzaBJzzKmTxrMxNLoZmQwZTB6v1NGDXa71LHZBVcxh77iWiUR0J7pmU6lunflemYmxpcYpiJOpyPQUlNZl8CHupchcmwwkN9pi26W6rqp38IEqvDWnD3jMNGnY+rUUCVuc2ItwPxGTpvAVQnUs9iuNlWyX0tSc5tt4S2i0H9wRFVG1Spa3AbA6uD5kKxwC1+zCefZCmo1+HJhAbmAXG/AXvqKfq9OioFDOKNm8pRr7VYGbbHcCwrqNkW33P+E6L3kyNHp7X1x4X/4HxTFZrCyUarNvgh1tA1lbw2/LpdFmpWxX1U3yFXxAvnkXW2uKNM/lmaCvmIgdUdZuU1WHzZdIeUsMoq4dc1IdYI+NRVoaTT+6mMe5ijmnxOnBmScVZD55GjJwt+9BKrwpxNgOamAN6sJGuW0CfglEYnWZQJw9DE/JLoZI8bPrshNMaHuGE1cHrMcIns3XQPRxnmxKradknvKs3hfif1KKphkHyzjFqxuubjAsmUbMBtOGLbi3z2cFKRKUwTkySfwRjQU1E="
