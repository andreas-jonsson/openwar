version: 0.0.1.{build}

platform: x64

branches:
    only:
        - master

clone_folder: c:\gopath\src\github.com\andreas-jonsson\openwar

environment:
    GOPATH: c:\gopath

install:
    - appveyor DownloadFile https://storage.googleapis.com/golang/go1.6.3.windows-amd64.msi
    - msiexec /i go1.6.3.windows-amd64.msi /q
    - go version
    - go env

    - appveyor DownloadFile https://dl.dropboxusercontent.com/u/1955192/dependencies.7z
    - 7z x dependencies.7z -oc:\gopath\src\github.com\andreas-jonsson\openwar\tools\package

    - appveyor DownloadFile https://dl.dropboxusercontent.com/u/1955192/inno.7z
    - 7z x inno.7z -o"c:\Program Files (x86)"

    - appveyor DownloadFile https://dl.dropboxusercontent.com/u/1955192/msys64.7z
    - rename c:\msys64 _msys64
    - 7z x msys64.7z -oc:\

    - set PATH=c:\msys64\usr\bin;c:\msys64\mingw64\bin;%PATH%
    - set PKG_CONFIG_PATH=%PKG_CONFIG_PATH%:/mingw64/lib/pkgconfig

build_script:
    - bash -c "go get && go build openwar.go"

after_build:
    - "c:\\Program Files (x86)\\Inno Setup 5\\iscc.exe" /Qp /O"" /Fopenwar-0.0.1.%APPVEYOR_BUILD_VERSION%-win64 tools\package\setup.iss
    # - move tools\package\Output\openwar-0.0.1-win64.exe openwar-0.0.1.%APPVEYOR_BUILD_VERSION%-win64.exe

artifacts:
    - path: openwar-0.0.1.%APPVEYOR_BUILD_VERSION%-win64.exe
    # - name: openwar
